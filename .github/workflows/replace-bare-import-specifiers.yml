name: replace bare import specificiers
on:
    push:
        branches:
            - main
jobs:
    replace:
        runs-on: macos-latest
        steps:
            - uses: denoland/setup-deno@v1
              with:
                  deno-version: vx.x.x
            - uses: actions/checkout@v2
            - name: Merge main -> url-imports
              uses: everlytic/branch-merge@1.1.2
              with:
                  github_token: ${{ github.token }}
                  source_ref: ${{ github.ref }}
                  target_branch: "url-imports"
                  commit_message_template: "[Automated] Merged {source_ref} into target {target_branch}"
            - name: checkout url-imports
              uses: actions/checkout@v2
              with:
                  ref: url-imports
            - name: replace bare import specificiers in files
              run: deno run -A ./.github/workflows/replace-bare-import-specifiers.js
            - name: git config
              run: |
                  git config user.name github-actions
                  git config user.email github-actions@github.com
            - name: stage changed files
              run: git add .
            - name: get git sha
              run: |
                  echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
                  echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"
            - uses: actions/github-script@v5
              with:
                  script: |
                      octokit.git.createCommit({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        message: "replace bare import specificiers with urls",
                        tree: context.sha
                      })
            - name: push
              run: git push
